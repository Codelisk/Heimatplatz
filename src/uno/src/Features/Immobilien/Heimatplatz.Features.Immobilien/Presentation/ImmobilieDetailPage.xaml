<Page x:Class="Heimatplatz.Features.Immobilien.Presentation.ImmobilieDetailPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:Heimatplatz.Features.Immobilien.Presentation"
      xmlns:controls="using:Heimatplatz.Core.Controls.Controls"
      xmlns:fwControls="using:UnoFramework.Controls"
      xmlns:utu="using:Uno.Toolkit.UI"
      xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
      NavigationCacheMode="Disabled"
      Background="{ThemeResource BackgroundBrush}">

    <Grid>
        <fwControls:BusyOverlay IsBusy="{Binding IsBusy}" BusyMessage="{Binding BusyMessage}">
            <Grid RowSpacing="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Header -->
                <controls:AppHeader
                    Grid.Row="0"
                    ObjectCount="{Binding TotalCount}" />

                <!-- Main Content -->
                <ScrollViewer Grid.Row="1">
                    <StackPanel>

                        <!-- Hero Image with Overlay -->
                        <Grid Height="{utu:Responsive Narrowest=250, Narrow=300, Normal=400, Wide=500}">
                            <Image
                                Source="{Binding HauptbildUrl}"
                                Stretch="UniformToFill"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center" />

                            <!-- Gradient Overlay -->
                            <Border>
                                <Border.Background>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                                        <GradientStop Color="Transparent" Offset="0.4" />
                                        <GradientStop Color="#CC000000" Offset="1" />
                                    </LinearGradientBrush>
                                </Border.Background>
                            </Border>

                            <!-- Title Overlay -->
                            <StackPanel VerticalAlignment="Bottom" Padding="24,0,24,24">
                                <TextBlock
                                    Text="{Binding OrtUppercase}"
                                    Foreground="White"
                                    FontSize="{utu:Responsive Narrowest=28, Narrow=36, Normal=48, Wide=56}"
                                    FontWeight="Black" />
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <Border Width="4" Height="16" Background="White" VerticalAlignment="Center" />
                                    <TextBlock
                                        Text="{Binding Immobilie.Beschreibung}"
                                        Foreground="White"
                                        FontSize="14"
                                        Opacity="0.9"
                                        MaxLines="1"
                                        TextTrimming="CharacterEllipsis" />
                                </StackPanel>
                            </StackPanel>
                        </Grid>

                        <!-- Image Gallery Strip -->
                        <ScrollViewer
                            HorizontalScrollBarVisibility="Auto"
                            VerticalScrollBarVisibility="Disabled"
                            HorizontalScrollMode="Auto"
                            VerticalScrollMode="Disabled">
                            <muxc:ItemsRepeater ItemsSource="{Binding Immobilie.Bilder}">
                                <muxc:ItemsRepeater.Layout>
                                    <muxc:StackLayout Orientation="Horizontal" Spacing="0" />
                                </muxc:ItemsRepeater.Layout>
                                <muxc:ItemsRepeater.ItemTemplate>
                                    <DataTemplate>
                                        <Image
                                            Source="{Binding Url}"
                                            Height="120"
                                            Width="180"
                                            Stretch="UniformToFill" />
                                    </DataTemplate>
                                </muxc:ItemsRepeater.ItemTemplate>
                            </muxc:ItemsRepeater>
                        </ScrollViewer>

                        <!-- Key Facts & Technical Info -->
                        <Grid Padding="{utu:Responsive Narrowest=16, Narrow=20, Normal=24, Wide=32}" Margin="0,24,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="{utu:Responsive Narrowest=0, Narrow=0, Normal=*, Wide=*}" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <!-- Key Facts -->
                            <Grid Grid.Column="0" Grid.Row="0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition Height="Auto" />
                                </Grid.RowDefinitions>

                                <!-- Price -->
                                <StackPanel Grid.Column="0" Grid.Row="0" Margin="0,0,16,16">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <Border Width="4" Height="40" Background="Black" />
                                        <StackPanel>
                                            <TextBlock Text="PRICE" FontSize="10" Foreground="{ThemeResource OnSurfaceVariantBrush}" />
                                            <TextBlock Text="{Binding PreisFormatiert}" FontSize="32" FontWeight="Bold" />
                                        </StackPanel>
                                    </StackPanel>
                                </StackPanel>

                                <!-- Living Area -->
                                <StackPanel Grid.Column="1" Grid.Row="0" Margin="0,0,0,16">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <Border Width="4" Height="40" Background="Black" />
                                        <StackPanel>
                                            <TextBlock Text="LIVING AREA" FontSize="10" Foreground="{ThemeResource OnSurfaceVariantBrush}" />
                                            <TextBlock Text="{Binding WohnflaecheFormatiert}" FontSize="32" FontWeight="Bold" />
                                        </StackPanel>
                                    </StackPanel>
                                </StackPanel>

                                <!-- Rooms -->
                                <StackPanel Grid.Column="0" Grid.Row="1" Margin="0,0,16,16">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <Border Width="4" Height="40" Background="Black" />
                                        <StackPanel>
                                            <TextBlock Text="ROOMS" FontSize="10" Foreground="{ThemeResource OnSurfaceVariantBrush}" />
                                            <TextBlock Text="{Binding ZimmerFormatiert}" FontSize="32" FontWeight="Bold" />
                                        </StackPanel>
                                    </StackPanel>
                                </StackPanel>

                                <!-- Plot Size -->
                                <StackPanel Grid.Column="1" Grid.Row="1" Margin="0,0,0,16">
                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                        <Border Width="4" Height="40" Background="Black" />
                                        <StackPanel>
                                            <TextBlock Text="PLOT SIZE" FontSize="10" Foreground="{ThemeResource OnSurfaceVariantBrush}" />
                                            <TextBlock Text="{Binding GrundstuecksflaecheFormatiert}" FontSize="32" FontWeight="Bold" />
                                        </StackPanel>
                                    </StackPanel>
                                </StackPanel>
                            </Grid>

                            <!-- Technical Facts & CTA (Right Column on Wide) -->
                            <StackPanel Grid.Column="1" Grid.Row="0" Grid.RowSpan="2"
                                        Margin="{utu:Responsive Narrowest='0,24,0,0', Normal='24,0,0,0'}"
                                        Spacing="16">

                                <!-- Technical Facts Card -->
                                <Border
                                    Background="{ThemeResource SurfaceBrush}"
                                    BorderBrush="{ThemeResource OnSurfaceVariantBrush}"
                                    BorderThickness="1"
                                    Padding="16">
                                    <StackPanel Spacing="8">
                                        <TextBlock
                                            Text="TECHNICAL FACTS"
                                            FontWeight="Bold"
                                            FontSize="14"
                                            Margin="0,0,0,8" />
                                        <Border Height="1" Background="{ThemeResource OnSurfaceVariantBrush}" Margin="0,0,0,8" />

                                        <muxc:ItemsRepeater ItemsSource="{Binding TechnicalFacts}">
                                            <muxc:ItemsRepeater.Layout>
                                                <muxc:StackLayout Spacing="8" />
                                            </muxc:ItemsRepeater.Layout>
                                            <muxc:ItemsRepeater.ItemTemplate>
                                                <DataTemplate>
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="Auto" />
                                                        </Grid.ColumnDefinitions>
                                                        <TextBlock
                                                            Grid.Column="0"
                                                            Text="{Binding Label}"
                                                            FontSize="12"
                                                            Foreground="{ThemeResource OnSurfaceVariantBrush}" />
                                                        <TextBlock
                                                            Grid.Column="1"
                                                            Text="{Binding Value}"
                                                            FontSize="12"
                                                            FontWeight="SemiBold"
                                                            HorizontalAlignment="Right" />
                                                    </Grid>
                                                </DataTemplate>
                                            </muxc:ItemsRepeater.ItemTemplate>
                                        </muxc:ItemsRepeater>
                                    </StackPanel>
                                </Border>

                                <!-- CTA Button -->
                                <Button
                                    Content="ANFRAGE SENDEN"
                                    Command="{Binding SendInquiryCommand}"
                                    HorizontalAlignment="Stretch"
                                    Background="Black"
                                    Foreground="White"
                                    Padding="24,16"
                                    FontWeight="Bold"
                                    FontSize="14" />

                            </StackPanel>

                            <!-- Highlights (Below Key Facts on Narrow) -->
                            <StackPanel Grid.Column="0" Grid.Row="1"
                                        Visibility="{utu:Responsive Narrowest=Visible, Normal=Collapsed}"
                                        Margin="0,16,0,0">
                                <TextBlock Text="HIGHLIGHTS" FontWeight="Bold" FontSize="14" Margin="0,0,0,12" />
                                <muxc:ItemsRepeater ItemsSource="{Binding Highlights}">
                                    <muxc:ItemsRepeater.Layout>
                                        <muxc:UniformGridLayout MinItemWidth="150" MinColumnSpacing="8" MinRowSpacing="8" />
                                    </muxc:ItemsRepeater.Layout>
                                    <muxc:ItemsRepeater.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal" Spacing="8" Padding="8">
                                                <CheckBox IsChecked="True" IsEnabled="False" />
                                                <TextBlock Text="{Binding}" VerticalAlignment="Center" FontSize="12" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </muxc:ItemsRepeater.ItemTemplate>
                                </muxc:ItemsRepeater>
                            </StackPanel>

                        </Grid>

                        <!-- Highlights Section (Wide only, separate section) -->
                        <StackPanel
                            Visibility="{utu:Responsive Narrowest=Collapsed, Normal=Visible}"
                            Padding="{utu:Responsive Normal=24, Wide=32}"
                            Margin="0,0,0,24">
                            <TextBlock Text="HIGHLIGHTS" FontWeight="Bold" FontSize="14" Margin="0,0,0,12" />
                            <muxc:ItemsRepeater ItemsSource="{Binding Highlights}">
                                <muxc:ItemsRepeater.Layout>
                                    <muxc:UniformGridLayout MinItemWidth="200" MinColumnSpacing="16" MinRowSpacing="8" />
                                </muxc:ItemsRepeater.Layout>
                                <muxc:ItemsRepeater.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="{ThemeResource SurfaceBrush}" Padding="12,8">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <CheckBox IsChecked="True" IsEnabled="False" />
                                                <TextBlock Text="{Binding}" VerticalAlignment="Center" FontSize="12" />
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </muxc:ItemsRepeater.ItemTemplate>
                            </muxc:ItemsRepeater>
                        </StackPanel>

                    </StackPanel>
                </ScrollViewer>

                <!-- Footer -->
                <controls:AppFooter Grid.Row="2" />

            </Grid>
        </fwControls:BusyOverlay>
    </Grid>

</Page>
