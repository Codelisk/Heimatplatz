<?xml version="1.0" encoding="utf-8" ?>
<pages:BasePage
    x:Class="Heimatplatz.Features.Notifications.Presentation.NotificationSettingsPage"
    x:Name="RootPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:utu="using:Uno.Toolkit.UI"
    xmlns:local="using:Heimatplatz.Features.Notifications.Presentation"
    xmlns:pages="using:UnoFramework.Pages"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    mc:Ignorable="d"
    NavigationCacheMode="Disabled"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Page.Resources>
        <!-- Chip style for location tags -->
        <Style x:Key="LocationChipStyle" TargetType="Border">
            <Setter Property="Background" Value="{ThemeResource SystemAccentColor}" />
            <Setter Property="CornerRadius" Value="16" />
            <Setter Property="Padding" Value="12,6" />
            <Setter Property="Margin" Value="4" />
        </Style>
    </Page.Resources>

    <ScrollViewer>
        <utu:AutoLayout
            Padding="24"
            Spacing="24"
            Orientation="Vertical"
            MaxWidth="800"
            HorizontalAlignment="Center">

            <!-- Description -->
            <TextBlock
                Text="Konfigurieren Sie, wann Sie ueber neue Immobilien benachrichtigt werden moechten."
                Style="{StaticResource BodyTextBlockStyle}"
                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                TextWrapping="Wrap" />

            <!-- Enable/Disable Toggle -->
            <utu:Card>
                <utu:AutoLayout Padding="16" Spacing="12" Orientation="Horizontal">
                    <FontIcon
                        Glyph="&#xEA8F;"
                        FontSize="24"
                        Foreground="{ThemeResource SystemAccentColor}"
                        VerticalAlignment="Center" />
                    <utu:AutoLayout Spacing="4" Orientation="Vertical" HorizontalAlignment="Stretch">
                        <TextBlock
                            Text="Benachrichtigungen aktivieren"
                            Style="{StaticResource SubtitleTextBlockStyle}" />
                        <TextBlock
                            Text="Push-Benachrichtigungen fuer neue Immobilien"
                            Style="{StaticResource CaptionTextBlockStyle}"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}" />
                    </utu:AutoLayout>
                    <ToggleSwitch
                        IsOn="{x:Bind ViewModel.IsEnabled, Mode=TwoWay}"
                        Toggled="OnNotificationsToggled"
                        VerticalAlignment="Center" />
                </utu:AutoLayout>
            </utu:Card>

            <!-- Filter Mode Selection -->
            <utu:Card>
                <utu:AutoLayout Padding="16" Spacing="16" Orientation="Vertical">
                    <utu:AutoLayout Spacing="4" Orientation="Vertical">
                        <TextBlock
                            Text="Filtermodus"
                            Style="{StaticResource SubtitleTextBlockStyle}" />
                        <TextBlock
                            Text="Waehlen Sie, fuer welche Immobilien Sie benachrichtigt werden moechten."
                            Style="{StaticResource CaptionTextBlockStyle}"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            TextWrapping="Wrap" />
                    </utu:AutoLayout>

                    <!-- RadioButton: Alle -->
                    <RadioButton
                        x:Name="FilterModeAllRadio"
                        GroupName="FilterMode"
                        IsChecked="{x:Bind ViewModel.IsFilterModeAll, Mode=TwoWay}"
                        AutomationProperties.AutomationId="NotificationSettings_FilterMode_All">
                        <utu:AutoLayout Spacing="4" Orientation="Vertical">
                            <TextBlock
                                Text="Alle Immobilien"
                                Style="{StaticResource BodyStrongTextBlockStyle}" />
                            <TextBlock
                                Text="Benachrichtigung bei jeder neuen Immobilie"
                                Style="{StaticResource CaptionTextBlockStyle}"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                TextWrapping="Wrap" />
                        </utu:AutoLayout>
                    </RadioButton>

                    <!-- RadioButton: Wie Suchfilter -->
                    <RadioButton
                        x:Name="FilterModeSameAsSearchRadio"
                        GroupName="FilterMode"
                        IsChecked="{x:Bind ViewModel.IsFilterModeSameAsSearch, Mode=TwoWay}"
                        AutomationProperties.AutomationId="NotificationSettings_FilterMode_SameAsSearch">
                        <utu:AutoLayout Spacing="4" Orientation="Vertical">
                            <TextBlock
                                Text="Wie Suchfilter"
                                Style="{StaticResource BodyStrongTextBlockStyle}" />
                            <TextBlock
                                Text="Verwendet automatisch Ihre aktuellen Suchfilter-Einstellungen"
                                Style="{StaticResource CaptionTextBlockStyle}"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                TextWrapping="Wrap" />
                        </utu:AutoLayout>
                    </RadioButton>

                    <!-- RadioButton: Benutzerdefiniert -->
                    <RadioButton
                        x:Name="FilterModeCustomRadio"
                        GroupName="FilterMode"
                        IsChecked="{x:Bind ViewModel.IsFilterModeCustom, Mode=TwoWay}"
                        AutomationProperties.AutomationId="NotificationSettings_FilterMode_Custom">
                        <utu:AutoLayout Spacing="4" Orientation="Vertical">
                            <TextBlock
                                Text="Benutzerdefiniert"
                                Style="{StaticResource BodyStrongTextBlockStyle}" />
                            <TextBlock
                                Text="Eigene Filterkriterien fuer Benachrichtigungen festlegen"
                                Style="{StaticResource CaptionTextBlockStyle}"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                TextWrapping="Wrap" />
                        </utu:AutoLayout>
                    </RadioButton>
                </utu:AutoLayout>
            </utu:Card>

            <!-- Custom Filter Section (only visible when Custom mode is selected) -->
            <utu:AutoLayout
                Spacing="24"
                Orientation="Vertical"
                Visibility="{x:Bind ViewModel.IsCustomFilterVisible, Mode=OneWay}">

                <!-- Immobilientyp Filter -->
                <utu:Card>
                    <utu:AutoLayout Padding="16" Spacing="16" Orientation="Vertical">
                        <utu:AutoLayout Spacing="4" Orientation="Vertical">
                            <TextBlock
                                Text="Immobilientyp"
                                Style="{StaticResource SubtitleTextBlockStyle}" />
                            <TextBlock
                                Text="Waehlen Sie die Immobilientypen, fuer die Sie benachrichtigt werden moechten."
                                Style="{StaticResource CaptionTextBlockStyle}"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                TextWrapping="Wrap" />
                        </utu:AutoLayout>

                        <StackPanel Orientation="Horizontal"
                                    Spacing="8"
                                    AutomationProperties.AutomationId="NotificationSettings_PropertyTypeChips">
                            <ToggleButton
                                Content="Haus"
                                IsChecked="{x:Bind ViewModel.IsHausSelected, Mode=TwoWay}"
                                Style="{StaticResource FilterChipBaseStyle}"
                                Click="OnCustomFilterChanged"
                                AutomationProperties.AutomationId="NotificationSettings_Chip_Haus" />
                            <ToggleButton
                                Content="Grundstueck"
                                IsChecked="{x:Bind ViewModel.IsGrundstueckSelected, Mode=TwoWay}"
                                Style="{StaticResource FilterChipBaseStyle}"
                                Click="OnCustomFilterChanged"
                                AutomationProperties.AutomationId="NotificationSettings_Chip_Grundstueck" />
                            <ToggleButton
                                Content="Zwangsversteigerung"
                                IsChecked="{x:Bind ViewModel.IsZwangsversteigerungSelected, Mode=TwoWay}"
                                Style="{StaticResource FilterChipBaseStyle}"
                                Click="OnCustomFilterChanged"
                                AutomationProperties.AutomationId="NotificationSettings_Chip_Zwangsversteigerung" />
                        </StackPanel>
                    </utu:AutoLayout>
                </utu:Card>

                <!-- Anbietertyp Filter -->
                <utu:Card>
                    <utu:AutoLayout Padding="16" Spacing="16" Orientation="Vertical">
                        <utu:AutoLayout Spacing="4" Orientation="Vertical">
                            <TextBlock
                                Text="Anbietertyp"
                                Style="{StaticResource SubtitleTextBlockStyle}" />
                            <TextBlock
                                Text="Waehlen Sie die Anbietertypen, fuer die Sie benachrichtigt werden moechten."
                                Style="{StaticResource CaptionTextBlockStyle}"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                TextWrapping="Wrap" />
                        </utu:AutoLayout>

                        <StackPanel Orientation="Horizontal"
                                    Spacing="8"
                                    AutomationProperties.AutomationId="NotificationSettings_SellerTypeChips">
                            <ToggleButton
                                Content="Privat"
                                IsChecked="{x:Bind ViewModel.IsPrivateSelected, Mode=TwoWay}"
                                Style="{StaticResource FilterChipBaseStyle}"
                                Click="OnCustomFilterChanged"
                                AutomationProperties.AutomationId="NotificationSettings_Chip_Private" />
                            <ToggleButton
                                Content="Makler"
                                IsChecked="{x:Bind ViewModel.IsBrokerSelected, Mode=TwoWay}"
                                Style="{StaticResource FilterChipBaseStyle}"
                                Click="OnCustomFilterChanged"
                                AutomationProperties.AutomationId="NotificationSettings_Chip_Broker" />
                            <ToggleButton
                                Content="Portal"
                                IsChecked="{x:Bind ViewModel.IsPortalSelected, Mode=TwoWay}"
                                Style="{StaticResource FilterChipBaseStyle}"
                                Click="OnCustomFilterChanged"
                                AutomationProperties.AutomationId="NotificationSettings_Chip_Portal" />
                        </StackPanel>
                    </utu:AutoLayout>
                </utu:Card>

                <!-- Location Filters -->
                <utu:Card>
                    <utu:AutoLayout Padding="16" Spacing="16" Orientation="Vertical">
                        <utu:AutoLayout Spacing="8" Orientation="Vertical">
                            <TextBlock
                                Text="Orte"
                                Style="{StaticResource SubtitleTextBlockStyle}" />
                            <TextBlock
                                Text="Waehlen Sie die Orte aus, fuer die Sie Benachrichtigungen erhalten moechten. Leer = alle Orte."
                                Style="{StaticResource CaptionTextBlockStyle}"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                TextWrapping="Wrap" />
                        </utu:AutoLayout>

                        <!-- Add Location Input -->
                        <utu:AutoLayout Spacing="8" Orientation="Horizontal">
                            <TextBox
                                x:Name="LocationTextBox"
                                PlaceholderText="Ort hinzufuegen (z.B. Zuerich, Bern)"
                                Text="{x:Bind ViewModel.NewLocation, Mode=TwoWay}"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Center"
                                KeyDown="OnLocationKeyDown" />
                            <Button
                                Content="Hinzufuegen"
                                Click="OnAddLocationClick"
                                Style="{StaticResource AccentButtonStyle}"
                                VerticalAlignment="Center" />
                        </utu:AutoLayout>

                        <!-- Location List -->
                        <ItemsRepeater
                            ItemsSource="{x:Bind ViewModel.Locations, Mode=OneWay}">
                            <ItemsRepeater.Layout>
                                <StackLayout Orientation="Vertical" Spacing="8" />
                            </ItemsRepeater.Layout>
                            <ItemsRepeater.ItemTemplate>
                                <DataTemplate x:DataType="x:String">
                                    <Border Style="{StaticResource LocationChipStyle}">
                                        <utu:AutoLayout Spacing="8" Orientation="Horizontal">
                                            <FontIcon
                                                Glyph="&#xE707;"
                                                FontSize="16"
                                                Foreground="White"
                                                VerticalAlignment="Center" />
                                            <TextBlock
                                                Text="{x:Bind}"
                                                Foreground="White"
                                                VerticalAlignment="Center" />
                                            <Button
                                                Content="&#xE711;"
                                                FontFamily="Segoe MDL2 Assets"
                                                Foreground="White"
                                                Background="Transparent"
                                                BorderThickness="0"
                                                Padding="4"
                                                Click="OnRemoveLocationClick"
                                                Tag="{x:Bind}"
                                                VerticalAlignment="Center" />
                                        </utu:AutoLayout>
                                    </Border>
                                </DataTemplate>
                            </ItemsRepeater.ItemTemplate>
                        </ItemsRepeater>
                    </utu:AutoLayout>
                </utu:Card>
            </utu:AutoLayout>

            <!-- Info Card -->
            <utu:Card Background="{ThemeResource SystemFillColorAttentionBackgroundBrush}">
                <utu:AutoLayout Padding="16" Spacing="12" Orientation="Horizontal">
                    <FontIcon
                        Glyph="&#xE946;"
                        FontSize="20"
                        Foreground="{ThemeResource SystemAccentColor}"
                        VerticalAlignment="Top" />
                    <TextBlock
                        Style="{StaticResource CaptionTextBlockStyle}"
                        Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                        TextWrapping="Wrap"
                        VerticalAlignment="Center">
                        <Run Text="Sie erhalten eine Benachrichtigung, sobald eine neue Immobilie erstellt wird, die Ihren Filtereinstellungen entspricht." />
                    </TextBlock>
                </utu:AutoLayout>
            </utu:Card>
        </utu:AutoLayout>
    </ScrollViewer>
</pages:BasePage>
