<ufp:BasePage x:Class="Heimatplatz.Features.Properties.Presentation.HomePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:Heimatplatz.Features.Properties.Presentation"
      xmlns:controls="using:Heimatplatz.Features.Properties.Controls"
      xmlns:utu="using:Uno.Toolkit.UI"
      xmlns:uen="using:Uno.Extensions.Navigation.UI"
      xmlns:uc="using:UnoFramework.Controls"
      xmlns:ufp="using:UnoFramework.Pages"
      NavigationCacheMode="Disabled">

    <!--
    HomePage - Premium Editorial Design
    Elegantes Layout mit grosszuegigem Weissraum
    Header wurde in Shell verschoben (AppHeader Control)
    -->

    <Grid Background="{ThemeResource BackgroundBrush}"
          AutomationProperties.AutomationId="HomePage_Root">

        <uc:BusyOverlay IsBusy="{Binding IsBusy}"
                        BusyMessage="{Binding BusyMessage}"
                        AutomationProperties.AutomationId="HomePage_BusyOverlay">

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Desktop Filter ist jetzt im AppHeader (HeaderCenter Region) -->

                <!-- Mobile Filter (unter 905px) -->
                <Border Grid.Row="0"
                        Background="{ThemeResource SurfaceBrush}"
                        BorderBrush="{ThemeResource BorderBrush}"
                        BorderThickness="0,0,0,1"
                        Padding="12,8"
                        Visibility="{utu:Responsive Narrowest=Visible, Narrow=Visible, Normal=Visible, Wide=Collapsed}"
                        AutomationProperties.AutomationId="HomePage_MobileFilter">
                    <StackPanel Spacing="8">
                        <!-- Ergebnis-Counter Mobile -->
                        <TextBlock Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                   FontSize="12"
                                   HorizontalAlignment="Right"
                                   AutomationProperties.AutomationId="HomePage_MobileResultCount">
                            <Run Text="{Binding Properties.Count}" FontWeight="SemiBold" Foreground="{ThemeResource OnSurfaceBrush}" />
                            <Run Text=" Objekte" />
                        </TextBlock>

                        <!-- OrtPicker und Alters-Filter auf Mobile -->
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <controls:OrtPicker Bezirke="{Binding Bezirke}"
                                                SelectedOrte="{Binding SelectedOrte, Mode=TwoWay}"
                                                HorizontalAlignment="Stretch"
                                                AutomationProperties.AutomationId="HomePage_MobileOrtPicker" />
                            <controls:AgeFilterPicker SelectedAgeFilter="{Binding SelectedAgeFilter, Mode=TwoWay}"
                                                      HorizontalAlignment="Stretch"
                                                      AutomationProperties.AutomationId="HomePage_MobileAgeFilterPicker" />
                        </StackPanel>

                        <!-- Filter Chips: Kurze Labels bei Mobile -->
                        <StackPanel Orientation="Horizontal" Spacing="6">
                            <controls:FilterChip Label="Haus"
                                                 IsSelected="{Binding IsHausSelected, Mode=TwoWay}" />
                            <controls:FilterChip Label="Grund"
                                                 IsSelected="{Binding IsGrundstueckSelected, Mode=TwoWay}" />
                            <controls:FilterChip Label="ZV"
                                                 IsSelected="{Binding IsZwangsversteigerungSelected, Mode=TwoWay}" />
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Content: Responsives Grid Layout -->
                <ScrollViewer Grid.Row="1"
                              Padding="{utu:Responsive Narrowest='12', Normal='20,16'}"
                              AutomationProperties.AutomationId="HomePage_ScrollViewer">
                    <StackPanel>
                        <ItemsRepeater ItemsSource="{Binding Properties}"
                                       AutomationProperties.AutomationId="HomePage_PropertyList">
                            <ItemsRepeater.Layout>
                                <UniformGridLayout Orientation="Horizontal"
                                                   MinItemWidth="280"
                                                   MinItemHeight="290"
                                                   MinRowSpacing="16"
                                                   MinColumnSpacing="16"
                                                   ItemsStretch="Fill" />
                            </ItemsRepeater.Layout>
                            <ItemsRepeater.ItemTemplate>
                                <DataTemplate>
                                    <controls:PropertyCard Property="{Binding}"
                                                           CardClicked="OnPropertyCardClicked"
                                                           PropertyBlocked="OnPropertyBlocked"
                                                           PropertyFavorited="OnPropertyFavorited"
                                                           Loaded="OnPropertyCardLoaded"
                                                           AutomationProperties.AutomationId="HomePage_PropertyCard" />
                                </DataTemplate>
                            </ItemsRepeater.ItemTemplate>
                        </ItemsRepeater>

                        <!-- Footer -->
                        <Border Margin="0,32,0,16"
                                Padding="0,16,0,0"
                                BorderBrush="{ThemeResource BorderBrush}"
                                BorderThickness="0,1,0,0"
                                AutomationProperties.AutomationId="HomePage_Footer">
                            <StackPanel Orientation="Horizontal"
                                        HorizontalAlignment="Center"
                                        Spacing="24">
                                <HyperlinkButton Content="Datenschutz"
                                                 uen:Navigation.Request="PrivacyPolicy"
                                                 Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                                 FontSize="12"
                                                 AutomationProperties.AutomationId="HomePage_PrivacyPolicyLink" />
                                <TextBlock Text="Heimatplatz"
                                           Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                           FontSize="12"
                                           Opacity="0.6"
                                           VerticalAlignment="Center" />
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>

                <!-- Empty State: Schlicht -->
                <StackPanel Grid.Row="1"
                            Visibility="{Binding IsEmpty}"
                            VerticalAlignment="Center"
                            HorizontalAlignment="Center"
                            Spacing="8"
                            AutomationProperties.AutomationId="HomePage_EmptyState">
                    <TextBlock Text="â€”"
                               FontSize="32"
                               Foreground="{ThemeResource OnSurfaceVariantBrush}"
                               HorizontalAlignment="Center" />
                    <TextBlock Text="Keine Treffer"
                               FontSize="14"
                               Foreground="{ThemeResource OnSurfaceVariantBrush}"
                               HorizontalAlignment="Center"
                               AutomationProperties.AutomationId="HomePage_EmptyText" />
                </StackPanel>
            </Grid>
        </uc:BusyOverlay>
    </Grid>
</ufp:BasePage>
