<Page x:Class="Heimatplatz.Features.Properties.Presentation.PropertyDetailPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:Heimatplatz.Features.Properties.Presentation"
      xmlns:utu="using:Uno.Toolkit.UI"
      xmlns:uc="using:UnoFramework.Controls"
      x:Name="RootPage"
      NavigationCacheMode="Disabled">

    <!--
    PropertyDetailPage - Immobilien Detailansicht
    Responsive: Mobile (scrollbar) / Desktop (zwei Spalten)
    -->

    <Grid Background="{ThemeResource BackgroundBrush}">
        <uc:BusyOverlay IsBusy="{x:Bind ViewModel.IsBusy, Mode=OneWay}"
                        BusyMessage="{x:Bind ViewModel.BusyMessage, Mode=OneWay}">

            <Grid utu:SafeArea.Insets="Top">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Header -->
                <Border Grid.Row="0"
                        Background="{ThemeResource SurfaceBrush}"
                        BorderBrush="{ThemeResource BorderBrush}"
                        BorderThickness="0,0,0,1"
                        Padding="{utu:Responsive Narrowest='12,10', Normal='20,12'}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <!-- Zurueck Button -->
                        <Button Grid.Column="0"
                                Click="OnBackClick"
                                Background="Transparent"
                                BorderThickness="0"
                                Padding="8"
                                VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE72B;"
                                          FontSize="16"
                                          Foreground="{ThemeResource OnSurfaceBrush}" />
                                <TextBlock Text="Zurück"
                                           FontSize="14"
                                           Foreground="{ThemeResource OnSurfaceBrush}"
                                           VerticalAlignment="Center"
                                           Visibility="{utu:Responsive Narrowest=Collapsed, Normal=Visible}" />
                            </StackPanel>
                        </Button>

                        <!-- Logo (Desktop) -->
                        <TextBlock Grid.Column="1"
                                   Text="HEIMATPLATZ"
                                   FontSize="15"
                                   FontWeight="Bold"
                                   CharacterSpacing="150"
                                   Foreground="{ThemeResource OnSurfaceBrush}"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   Visibility="{utu:Responsive Narrowest=Collapsed, Normal=Visible}" />

                        <!-- Actions -->
                        <StackPanel Grid.Column="2"
                                    Orientation="Horizontal"
                                    Spacing="{utu:Responsive Narrowest=16, Normal=24}">
                            <Button Background="Transparent"
                                    BorderThickness="0"
                                    Padding="8"
                                    ToolTipService.ToolTip="Favorit">
                                <FontIcon Glyph="&#xEB51;"
                                          FontSize="20"
                                          Foreground="{ThemeResource OnSurfaceBrush}" />
                            </Button>
                            <Button Background="Transparent"
                                    BorderThickness="0"
                                    Padding="8"
                                    ToolTipService.ToolTip="Teilen">
                                <FontIcon Glyph="&#xE72D;"
                                          FontSize="20"
                                          Foreground="{ThemeResource OnSurfaceBrush}" />
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Content -->
                <ScrollViewer Grid.Row="1">
                    <!-- Desktop: Zwei-Spalten Layout -->
                    <Grid Padding="{utu:Responsive Narrowest='0', Normal='40,24'}"
                          MaxWidth="1200"
                          HorizontalAlignment="Center">

                        <!-- Mobile Layout -->
                        <Grid Visibility="{utu:Responsive Narrowest=Visible, Normal=Collapsed}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>

                            <ScrollViewer Grid.Row="0">
                                <StackPanel>
                                    <!-- Hero Image -->
                                    <Grid Height="200">
                                        <Border Background="{ThemeResource PlaceholderBrush}">
                                            <FontIcon Glyph="&#xE722;"
                                                      FontSize="48"
                                                      Foreground="{ThemeResource DetailsBrush}"
                                                      HorizontalAlignment="Center"
                                                      VerticalAlignment="Center" />
                                        </Border>
                                        <FlipView x:Name="MobileImageFlipView"
                                                  ItemsSource="{x:Bind ViewModel.Property.BildUrls, Mode=OneWay}">
                                            <FlipView.ItemTemplate>
                                                <DataTemplate>
                                                    <Image Source="{Binding}"
                                                           Stretch="UniformToFill" />
                                                </DataTemplate>
                                            </FlipView.ItemTemplate>
                                        </FlipView>

                                        <!-- Bild Counter -->
                                        <Border Background="#CC000000"
                                                CornerRadius="12"
                                                Padding="12,6"
                                                Margin="16"
                                                VerticalAlignment="Bottom"
                                                HorizontalAlignment="Left">
                                            <TextBlock FontSize="13" FontWeight="SemiBold" Foreground="White">
                                                <Run Text="{x:Bind ViewModel.CurrentImageIndex, Mode=OneWay}" />
                                                <Run Text=" / " />
                                                <Run Text="{x:Bind ViewModel.Property.BildUrls.Count, Mode=OneWay}" />
                                            </TextBlock>
                                        </Border>
                                    </Grid>

                                    <!-- Mobile Content -->
                                    <StackPanel Padding="16,12" Spacing="12" Background="{ThemeResource SurfaceBrush}">

                                        <!-- Titel zuerst -->
                                        <TextBlock Text="{x:Bind ViewModel.Property.Titel, Mode=OneWay}"
                                                   FontSize="17"
                                                   FontWeight="SemiBold"
                                                   Foreground="{ThemeResource OnSurfaceBrush}"
                                                   TextWrapping="Wrap"
                                                   LineHeight="22" />

                                        <!-- Preis und Typ -->
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="Auto" />
                                            </Grid.ColumnDefinitions>

                                            <TextBlock Grid.Column="0"
                                                       Text="{x:Bind ViewModel.FormattedPrice, Mode=OneWay}"
                                                       FontSize="26"
                                                       FontWeight="Bold"
                                                       Foreground="{ThemeResource AccentBrush}" />

                                            <Border Grid.Column="1"
                                                    Background="{ThemeResource SolidBackgroundFillColorSecondary}"
                                                    CornerRadius="12"
                                                    Padding="10,5"
                                                    VerticalAlignment="Center">
                                                <TextBlock Text="{x:Bind ViewModel.TypeText, Mode=OneWay}"
                                                           FontSize="11"
                                                           FontWeight="SemiBold"
                                                           Foreground="{ThemeResource OnSurfaceBrush}" />
                                            </Border>
                                        </Grid>

                                        <!-- Quick Facts -->
                                        <Border Background="{ThemeResource SolidBackgroundFillColorSecondary}"
                                                CornerRadius="{StaticResource RadiusSm}"
                                                Padding="12,10">
                                            <Grid ColumnSpacing="8">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="*" />
                                                    <ColumnDefinition Width="*" />
                                                </Grid.ColumnDefinitions>

                                                <!-- Fläche -->
                                                <StackPanel Grid.Column="0" HorizontalAlignment="Center" Spacing="2">
                                                    <FontIcon Glyph="&#xE737;"
                                                              FontSize="16"
                                                              Foreground="{ThemeResource AccentBrush}"
                                                              HorizontalAlignment="Center" />
                                                    <TextBlock Text="{x:Bind ViewModel.Property.WohnflaecheM2, Mode=OneWay}"
                                                               FontSize="14"
                                                               FontWeight="SemiBold"
                                                               Foreground="{ThemeResource OnSurfaceBrush}"
                                                               HorizontalAlignment="Center" />
                                                    <TextBlock Text="m²"
                                                               FontSize="11"
                                                               Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                                               HorizontalAlignment="Center" />
                                                </StackPanel>

                                                <!-- Zimmer -->
                                                <StackPanel Grid.Column="1" HorizontalAlignment="Center" Spacing="2">
                                                    <FontIcon Glyph="&#xE80F;"
                                                              FontSize="16"
                                                              Foreground="{ThemeResource AccentBrush}"
                                                              HorizontalAlignment="Center" />
                                                    <TextBlock Text="{x:Bind ViewModel.Property.Zimmer, Mode=OneWay}"
                                                               FontSize="14"
                                                               FontWeight="SemiBold"
                                                               Foreground="{ThemeResource OnSurfaceBrush}"
                                                               HorizontalAlignment="Center" />
                                                    <TextBlock Text="Zimmer"
                                                               FontSize="11"
                                                               Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                                               HorizontalAlignment="Center" />
                                                </StackPanel>

                                                <!-- Baujahr -->
                                                <StackPanel Grid.Column="2" HorizontalAlignment="Center" Spacing="2">
                                                    <FontIcon Glyph="&#xE787;"
                                                              FontSize="16"
                                                              Foreground="{ThemeResource AccentBrush}"
                                                              HorizontalAlignment="Center" />
                                                    <TextBlock Text="{x:Bind ViewModel.Property.Baujahr, Mode=OneWay}"
                                                               FontSize="14"
                                                               FontWeight="SemiBold"
                                                               Foreground="{ThemeResource OnSurfaceBrush}"
                                                               HorizontalAlignment="Center" />
                                                    <TextBlock Text="Baujahr"
                                                               FontSize="11"
                                                               Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                                               HorizontalAlignment="Center" />
                                                </StackPanel>
                                            </Grid>
                                        </Border>

                                        <!-- Divider -->
                                        <Border Height="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                                        <!-- Beschreibung -->
                                        <StackPanel Spacing="6">
                                            <TextBlock Text="Beschreibung"
                                                       FontSize="15"
                                                       FontWeight="SemiBold"
                                                       Foreground="{ThemeResource OnSurfaceBrush}" />
                                            <TextBlock Text="{x:Bind ViewModel.Property.Beschreibung, Mode=OneWay}"
                                                       FontSize="13"
                                                       Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                                       TextWrapping="Wrap"
                                                       LineHeight="20"
                                                       MaxLines="4"
                                                       TextTrimming="CharacterEllipsis" />
                                        </StackPanel>

                                        <!-- Divider -->
                                        <Border Height="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                                        <!-- Ausstattung als Chips -->
                                        <StackPanel Spacing="8">
                                            <TextBlock Text="Ausstattung"
                                                       FontSize="15"
                                                       FontWeight="SemiBold"
                                                       Foreground="{ThemeResource OnSurfaceBrush}" />
                                            <ItemsRepeater ItemsSource="{x:Bind ViewModel.Property.Ausstattung, Mode=OneWay}">
                                                <ItemsRepeater.Layout>
                                                    <UniformGridLayout Orientation="Horizontal"
                                                                       MinItemWidth="100"
                                                                       MinItemHeight="32"
                                                                       MinColumnSpacing="6"
                                                                       MinRowSpacing="6"
                                                                       ItemsStretch="None" />
                                                </ItemsRepeater.Layout>
                                                <ItemsRepeater.ItemTemplate>
                                                    <DataTemplate x:DataType="x:String">
                                                        <Border Background="{ThemeResource SolidBackgroundFillColorSecondary}"
                                                                CornerRadius="12"
                                                                Padding="10,5"
                                                                HorizontalAlignment="Left">
                                                            <StackPanel Orientation="Horizontal" Spacing="4">
                                                                <FontIcon Glyph="&#xE73E;"
                                                                          FontSize="10"
                                                                          Foreground="{ThemeResource AccentBrush}" />
                                                                <TextBlock Text="{x:Bind}"
                                                                           FontSize="12"
                                                                           Foreground="{ThemeResource OnSurfaceBrush}" />
                                                            </StackPanel>
                                                        </Border>
                                                    </DataTemplate>
                                                </ItemsRepeater.ItemTemplate>
                                            </ItemsRepeater>
                                        </StackPanel>

                                        <!-- Divider -->
                                        <Border Height="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}" />

                                        <!-- Standort -->
                                        <StackPanel Spacing="8">
                                            <TextBlock Text="Standort"
                                                       FontSize="15"
                                                       FontWeight="SemiBold"
                                                       Foreground="{ThemeResource OnSurfaceBrush}" />
                                            <StackPanel Orientation="Horizontal" Spacing="6">
                                                <FontIcon Glyph="&#xE707;"
                                                          FontSize="14"
                                                          Foreground="{ThemeResource AccentBrush}" />
                                                <TextBlock FontSize="13"
                                                           Foreground="{ThemeResource OnSurfaceVariantBrush}">
                                                    <Run Text="{x:Bind ViewModel.Property.Adresse, Mode=OneWay}" />
                                                    <Run Text=", " />
                                                    <Run Text="{x:Bind ViewModel.Property.Ort, Mode=OneWay}" />
                                                </TextBlock>
                                            </StackPanel>
                                            <!-- Map Placeholder -->
                                            <Border Background="{ThemeResource PlaceholderBrush}"
                                                    CornerRadius="{StaticResource RadiusSm}"
                                                    Height="120">
                                                <StackPanel VerticalAlignment="Center" Spacing="4">
                                                    <FontIcon Glyph="&#xE707;"
                                                              FontSize="24"
                                                              Foreground="{ThemeResource DetailsBrush}"
                                                              HorizontalAlignment="Center" />
                                                    <TextBlock Text="Karte wird geladen..."
                                                               FontSize="11"
                                                               Foreground="{ThemeResource DetailsBrush}"
                                                               HorizontalAlignment="Center" />
                                                </StackPanel>
                                            </Border>
                                        </StackPanel>

                                        <!-- Spacer für den sticky Button -->
                                        <Border Height="16" />
                                    </StackPanel>
                                </StackPanel>
                            </ScrollViewer>

                            <!-- Sticky CTA Button -->
                            <Border Grid.Row="1"
                                    Background="{ThemeResource SurfaceBrush}"
                                    BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                                    BorderThickness="0,1,0,0"
                                    Padding="16,12"
                                    utu:SafeArea.Insets="Bottom">
                                <Button Content="Anbieter kontaktieren"
                                        Background="{ThemeResource AccentBrush}"
                                        Foreground="{ThemeResource ChipSelectedForegroundBrush}"
                                        FontWeight="SemiBold"
                                        FontSize="14"
                                        Height="44"
                                        HorizontalAlignment="Stretch"
                                        HorizontalContentAlignment="Center"
                                        CornerRadius="{StaticResource RadiusSm}"
                                        Click="OnContactClick" />
                            </Border>
                        </Grid>

                        <!-- Desktop Layout -->
                        <Grid Visibility="{utu:Responsive Narrowest=Collapsed, Normal=Visible}"
                              ColumnSpacing="40">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*" MaxWidth="720" />
                                <ColumnDefinition Width="*" MinWidth="300" />
                            </Grid.ColumnDefinitions>

                            <!-- Links: Bilder -->
                            <StackPanel Grid.Column="0" Spacing="16">
                                <!-- Hauptbild -->
                                <Border CornerRadius="{StaticResource RadiusSm}"
                                        Height="480">
                                    <Border.Clip>
                                        <RectangleGeometry Rect="0,0,10000,480" />
                                    </Border.Clip>
                                    <Grid>
                                        <Border Background="{ThemeResource PlaceholderBrush}"
                                                CornerRadius="{StaticResource RadiusSm}">
                                            <FontIcon Glyph="&#xE722;"
                                                      FontSize="64"
                                                      Foreground="{ThemeResource DetailsBrush}"
                                                      HorizontalAlignment="Center"
                                                      VerticalAlignment="Center" />
                                        </Border>
                                        <FlipView x:Name="DesktopImageFlipView"
                                                  ItemsSource="{x:Bind ViewModel.Property.BildUrls, Mode=OneWay}"
                                                  SelectionChanged="OnImageSelectionChanged">
                                            <FlipView.ItemTemplate>
                                                <DataTemplate>
                                                    <Image Source="{Binding}"
                                                           Stretch="UniformToFill" />
                                                </DataTemplate>
                                            </FlipView.ItemTemplate>
                                        </FlipView>
                                    </Grid>
                                </Border>

                                <!-- Thumbnails -->
                                <ItemsRepeater x:Name="ThumbnailRepeater"
                                               ItemsSource="{x:Bind ViewModel.Property.BildUrls, Mode=OneWay}">
                                    <ItemsRepeater.Layout>
                                        <StackLayout Orientation="Horizontal" Spacing="12" />
                                    </ItemsRepeater.Layout>
                                    <ItemsRepeater.ItemTemplate>
                                        <DataTemplate>
                                            <Button Click="OnThumbnailClick"
                                                    Padding="0"
                                                    BorderThickness="0"
                                                    Background="Transparent"
                                                    Tag="{Binding}">
                                                <Border CornerRadius="{StaticResource RadiusSm}"
                                                        Width="120"
                                                        Height="80"
                                                        BorderThickness="2"
                                                        BorderBrush="{ThemeResource BorderBrush}">
                                                    <Border.Clip>
                                                        <RectangleGeometry Rect="0,0,120,80" />
                                                    </Border.Clip>
                                                    <Image Source="{Binding}"
                                                           Stretch="UniformToFill" />
                                                </Border>
                                            </Button>
                                        </DataTemplate>
                                    </ItemsRepeater.ItemTemplate>
                                </ItemsRepeater>
                            </StackPanel>

                            <!-- Rechts: Info -->
                            <StackPanel Grid.Column="1" Spacing="16">
                                <!-- Preis -->
                                <TextBlock Text="{x:Bind ViewModel.FormattedPrice, Mode=OneWay}"
                                           FontSize="32"
                                           FontWeight="Bold"
                                           Foreground="{ThemeResource OnSurfaceBrush}" />

                                <!-- Titel -->
                                <TextBlock Text="{x:Bind ViewModel.Property.Titel, Mode=OneWay}"
                                           FontSize="24"
                                           FontWeight="SemiBold"
                                           Foreground="{ThemeResource OnSurfaceBrush}"
                                           TextWrapping="Wrap" />

                                <!-- Details -->
                                <TextBlock Text="{x:Bind ViewModel.DetailsText, Mode=OneWay}"
                                           FontSize="16"
                                           Foreground="{ThemeResource OnSurfaceVariantBrush}" />

                                <!-- Typ Badge -->
                                <Border Background="{ThemeResource AccentBrush}"
                                        CornerRadius="{StaticResource RadiusSm}"
                                        Padding="14,8"
                                        HorizontalAlignment="Left">
                                    <TextBlock Text="{x:Bind ViewModel.TypeText, Mode=OneWay}"
                                               FontSize="12"
                                               FontWeight="Bold"
                                               CharacterSpacing="60"
                                               Foreground="{ThemeResource ChipSelectedForegroundBrush}" />
                                </Border>

                                <!-- Beschreibung -->
                                <StackPanel Spacing="12" Margin="0,16,0,0">
                                    <TextBlock Text="Beschreibung"
                                               FontSize="18"
                                               FontWeight="SemiBold"
                                               Foreground="{ThemeResource OnSurfaceBrush}" />
                                    <TextBlock Text="{x:Bind ViewModel.Property.Beschreibung, Mode=OneWay}"
                                               FontSize="14"
                                               Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                               TextWrapping="Wrap"
                                               LineHeight="22" />
                                </StackPanel>

                                <!-- Ausstattung -->
                                <StackPanel Spacing="12" Margin="0,16,0,0">
                                    <TextBlock Text="Ausstattung"
                                               FontSize="18"
                                               FontWeight="SemiBold"
                                               Foreground="{ThemeResource OnSurfaceBrush}" />
                                    <TextBlock Text="{x:Bind ViewModel.AusstattungText, Mode=OneWay}"
                                               FontSize="14"
                                               Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                               TextWrapping="Wrap" />
                                </StackPanel>

                                <!-- Anbieter Info -->
                                <Border Background="{ThemeResource SolidBackgroundFillColorSecondary}"
                                        CornerRadius="{StaticResource RadiusSm}"
                                        Padding="16"
                                        Margin="0,16,0,0">
                                    <StackPanel Spacing="8">
                                        <TextBlock Text="Anbieter"
                                                   FontSize="14"
                                                   FontWeight="SemiBold"
                                                   Foreground="{ThemeResource OnSurfaceBrush}" />
                                        <TextBlock Text="{x:Bind ViewModel.Property.AnbieterName, Mode=OneWay}"
                                                   FontSize="14"
                                                   Foreground="{ThemeResource OnSurfaceVariantBrush}" />
                                    </StackPanel>
                                </Border>

                                <!-- CTA Button -->
                                <Button Content="Anbieter kontaktieren"
                                        Background="{ThemeResource AccentBrush}"
                                        Foreground="{ThemeResource ChipSelectedForegroundBrush}"
                                        FontWeight="SemiBold"
                                        FontSize="16"
                                        Height="56"
                                        Width="300"
                                        HorizontalAlignment="Left"
                                        HorizontalContentAlignment="Center"
                                        CornerRadius="{StaticResource RadiusSm}"
                                        Margin="0,24,0,0"
                                        Click="OnContactClick" />
                            </StackPanel>
                        </Grid>
                    </Grid>
                </ScrollViewer>
            </Grid>
        </uc:BusyOverlay>
    </Grid>
</Page>
