<Page x:Class="Heimatplatz.Features.Properties.Presentation.PropertyDetailPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:Heimatplatz.Features.Properties.Presentation"
      xmlns:utu="using:Uno.Toolkit.UI"
      xmlns:uc="using:UnoFramework.Controls"
      x:Name="RootPage"
      NavigationCacheMode="Disabled">

    <!--
    PropertyDetailPage - Immobilien Detailansicht
    Responsive: Mobile (scrollbar) / Desktop (zwei Spalten)
    -->

    <Grid Background="{ThemeResource BackgroundBrush}">
        <uc:BusyOverlay IsBusy="{x:Bind ViewModel.IsBusy, Mode=OneWay}"
                        BusyMessage="{x:Bind ViewModel.BusyMessage, Mode=OneWay}">

            <Grid utu:SafeArea.Insets="Top">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Header -->
                <Border Grid.Row="0"
                        Background="{ThemeResource SurfaceBrush}"
                        BorderBrush="{ThemeResource BorderBrush}"
                        BorderThickness="0,0,0,1"
                        Padding="{utu:Responsive Narrowest='12,10', Normal='20,12'}">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <!-- Zurueck Button -->
                        <Button Grid.Column="0"
                                Click="OnBackClick"
                                Background="Transparent"
                                BorderThickness="0"
                                Padding="8"
                                VerticalAlignment="Center">
                            <StackPanel Orientation="Horizontal" Spacing="8">
                                <FontIcon Glyph="&#xE72B;"
                                          FontSize="16"
                                          Foreground="{ThemeResource OnSurfaceBrush}" />
                                <TextBlock Text="ZurÃ¼ck"
                                           FontSize="14"
                                           Foreground="{ThemeResource OnSurfaceBrush}"
                                           VerticalAlignment="Center"
                                           Visibility="{utu:Responsive Narrowest=Collapsed, Normal=Visible}" />
                            </StackPanel>
                        </Button>

                        <!-- Logo (Desktop) -->
                        <TextBlock Grid.Column="1"
                                   Text="HEIMATPLATZ"
                                   FontSize="15"
                                   FontWeight="Bold"
                                   CharacterSpacing="150"
                                   Foreground="{ThemeResource OnSurfaceBrush}"
                                   HorizontalAlignment="Center"
                                   VerticalAlignment="Center"
                                   Visibility="{utu:Responsive Narrowest=Collapsed, Normal=Visible}" />

                        <!-- Actions -->
                        <StackPanel Grid.Column="2"
                                    Orientation="Horizontal"
                                    Spacing="{utu:Responsive Narrowest=16, Normal=24}">
                            <Button Background="Transparent"
                                    BorderThickness="0"
                                    Padding="8"
                                    ToolTipService.ToolTip="Favorit">
                                <FontIcon Glyph="&#xEB51;"
                                          FontSize="20"
                                          Foreground="{ThemeResource OnSurfaceBrush}" />
                            </Button>
                            <Button Background="Transparent"
                                    BorderThickness="0"
                                    Padding="8"
                                    ToolTipService.ToolTip="Teilen">
                                <FontIcon Glyph="&#xE72D;"
                                          FontSize="20"
                                          Foreground="{ThemeResource OnSurfaceBrush}" />
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- Content -->
                <ScrollViewer Grid.Row="1">
                    <!-- Desktop: Zwei-Spalten Layout -->
                    <Grid Padding="{utu:Responsive Narrowest='0', Normal='40,24'}"
                          MaxWidth="1200"
                          HorizontalAlignment="Center">

                        <!-- Mobile Layout -->
                        <StackPanel Visibility="{utu:Responsive Narrowest=Visible, Normal=Collapsed}">
                            <!-- Hero Image -->
                            <Grid Height="280">
                                <Border Background="{ThemeResource PlaceholderBrush}">
                                    <FontIcon Glyph="&#xE722;"
                                              FontSize="48"
                                              Foreground="{ThemeResource DetailsBrush}"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center" />
                                </Border>
                                <FlipView x:Name="MobileImageFlipView"
                                          ItemsSource="{x:Bind ViewModel.Property.BildUrls, Mode=OneWay}">
                                    <FlipView.ItemTemplate>
                                        <DataTemplate>
                                            <Image Source="{Binding}"
                                                   Stretch="UniformToFill" />
                                        </DataTemplate>
                                    </FlipView.ItemTemplate>
                                </FlipView>

                                <!-- Bild Counter -->
                                <Border Background="#99000000"
                                        CornerRadius="{StaticResource RadiusSm}"
                                        Padding="8,4"
                                        Margin="12"
                                        VerticalAlignment="Bottom"
                                        HorizontalAlignment="Left">
                                    <TextBlock FontSize="11" Foreground="White">
                                        <Run Text="{x:Bind ViewModel.CurrentImageIndex, Mode=OneWay}" />
                                        <Run Text="/" />
                                        <Run Text="{x:Bind ViewModel.Property.BildUrls.Count, Mode=OneWay}" />
                                    </TextBlock>
                                </Border>
                            </Grid>

                            <!-- Mobile Content Card -->
                            <Border Background="{ThemeResource SurfaceBrush}"
                                    Margin="16,-20,16,16"
                                    Padding="16"
                                    CornerRadius="{StaticResource RadiusLg}"
                                    Translation="0,0,8">
                                <Border.Shadow>
                                    <ThemeShadow />
                                </Border.Shadow>

                                <StackPanel Spacing="16">
                                    <!-- Preis -->
                                    <TextBlock Text="{x:Bind ViewModel.FormattedPrice, Mode=OneWay}"
                                               FontSize="28"
                                               FontWeight="Bold"
                                               Foreground="{ThemeResource OnSurfaceBrush}" />

                                    <!-- Titel -->
                                    <TextBlock Text="{x:Bind ViewModel.Property.Titel, Mode=OneWay}"
                                               FontSize="20"
                                               FontWeight="SemiBold"
                                               Foreground="{ThemeResource OnSurfaceBrush}"
                                               TextWrapping="Wrap" />

                                    <!-- Details -->
                                    <TextBlock Text="{x:Bind ViewModel.DetailsText, Mode=OneWay}"
                                               FontSize="14"
                                               Foreground="{ThemeResource OnSurfaceVariantBrush}" />

                                    <!-- Typ Badge -->
                                    <Border Background="{ThemeResource AccentBrush}"
                                            CornerRadius="{StaticResource RadiusSm}"
                                            Padding="12,6"
                                            HorizontalAlignment="Left">
                                        <TextBlock Text="{x:Bind ViewModel.TypeText, Mode=OneWay}"
                                                   FontSize="12"
                                                   FontWeight="SemiBold"
                                                   Foreground="{ThemeResource ChipSelectedForegroundBrush}" />
                                    </Border>

                                    <!-- Beschreibung -->
                                    <StackPanel Spacing="8" Margin="0,8,0,0">
                                        <TextBlock Text="Beschreibung"
                                                   FontSize="16"
                                                   FontWeight="SemiBold"
                                                   Foreground="{ThemeResource OnSurfaceBrush}" />
                                        <TextBlock Text="{x:Bind ViewModel.Property.Beschreibung, Mode=OneWay}"
                                                   FontSize="14"
                                                   Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                                   TextWrapping="Wrap" />
                                    </StackPanel>

                                    <!-- Ausstattung -->
                                    <StackPanel Spacing="8" Margin="0,8,0,0">
                                        <TextBlock Text="Ausstattung"
                                                   FontSize="16"
                                                   FontWeight="SemiBold"
                                                   Foreground="{ThemeResource OnSurfaceBrush}" />
                                        <TextBlock Text="{x:Bind ViewModel.AusstattungText, Mode=OneWay}"
                                                   FontSize="14"
                                                   Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                                   TextWrapping="Wrap" />
                                    </StackPanel>

                                    <!-- Standort -->
                                    <StackPanel Spacing="8" Margin="0,8,0,0">
                                        <TextBlock Text="Standort"
                                                   FontSize="16"
                                                   FontWeight="SemiBold"
                                                   Foreground="{ThemeResource OnSurfaceBrush}" />
                                        <TextBlock FontSize="14"
                                                   Foreground="{ThemeResource OnSurfaceVariantBrush}">
                                            <Run Text="{x:Bind ViewModel.Property.Adresse, Mode=OneWay}" />
                                            <Run Text=", " />
                                            <Run Text="{x:Bind ViewModel.Property.Ort, Mode=OneWay}" />
                                        </TextBlock>
                                        <!-- Map Placeholder -->
                                        <Border Background="{ThemeResource PlaceholderBrush}"
                                                CornerRadius="{StaticResource RadiusMd}"
                                                Height="150">
                                            <FontIcon Glyph="&#xE707;"
                                                      FontSize="32"
                                                      Foreground="{ThemeResource DetailsBrush}"
                                                      HorizontalAlignment="Center"
                                                      VerticalAlignment="Center" />
                                        </Border>
                                    </StackPanel>

                                    <!-- CTA Button -->
                                    <Button Content="Anbieter kontaktieren"
                                            Background="{ThemeResource AccentBrush}"
                                            Foreground="{ThemeResource ChipSelectedForegroundBrush}"
                                            FontWeight="SemiBold"
                                            FontSize="16"
                                            Height="56"
                                            HorizontalAlignment="Stretch"
                                            HorizontalContentAlignment="Center"
                                            CornerRadius="{StaticResource RadiusMd}"
                                            Margin="0,8,0,0"
                                            Click="OnContactClick" />
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Desktop Layout -->
                        <Grid Visibility="{utu:Responsive Narrowest=Collapsed, Normal=Visible}"
                              ColumnSpacing="40">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*" MaxWidth="720" />
                                <ColumnDefinition Width="*" MinWidth="300" />
                            </Grid.ColumnDefinitions>

                            <!-- Links: Bilder -->
                            <StackPanel Grid.Column="0" Spacing="16">
                                <!-- Hauptbild -->
                                <Border CornerRadius="{StaticResource RadiusLg}"
                                        Height="480">
                                    <Border.Clip>
                                        <RectangleGeometry Rect="0,0,10000,480" />
                                    </Border.Clip>
                                    <Grid>
                                        <Border Background="{ThemeResource PlaceholderBrush}"
                                                CornerRadius="{StaticResource RadiusLg}">
                                            <FontIcon Glyph="&#xE722;"
                                                      FontSize="64"
                                                      Foreground="{ThemeResource DetailsBrush}"
                                                      HorizontalAlignment="Center"
                                                      VerticalAlignment="Center" />
                                        </Border>
                                        <FlipView x:Name="DesktopImageFlipView"
                                                  ItemsSource="{x:Bind ViewModel.Property.BildUrls, Mode=OneWay}"
                                                  SelectionChanged="OnImageSelectionChanged">
                                            <FlipView.ItemTemplate>
                                                <DataTemplate>
                                                    <Image Source="{Binding}"
                                                           Stretch="UniformToFill" />
                                                </DataTemplate>
                                            </FlipView.ItemTemplate>
                                        </FlipView>
                                    </Grid>
                                </Border>

                                <!-- Thumbnails -->
                                <ItemsRepeater x:Name="ThumbnailRepeater"
                                               ItemsSource="{x:Bind ViewModel.Property.BildUrls, Mode=OneWay}">
                                    <ItemsRepeater.Layout>
                                        <StackLayout Orientation="Horizontal" Spacing="12" />
                                    </ItemsRepeater.Layout>
                                    <ItemsRepeater.ItemTemplate>
                                        <DataTemplate>
                                            <Button Click="OnThumbnailClick"
                                                    Padding="0"
                                                    BorderThickness="0"
                                                    Background="Transparent"
                                                    Tag="{Binding}">
                                                <Border CornerRadius="{StaticResource RadiusMd}"
                                                        Width="120"
                                                        Height="80"
                                                        BorderThickness="2"
                                                        BorderBrush="{ThemeResource BorderBrush}">
                                                    <Border.Clip>
                                                        <RectangleGeometry Rect="0,0,120,80" />
                                                    </Border.Clip>
                                                    <Image Source="{Binding}"
                                                           Stretch="UniformToFill" />
                                                </Border>
                                            </Button>
                                        </DataTemplate>
                                    </ItemsRepeater.ItemTemplate>
                                </ItemsRepeater>
                            </StackPanel>

                            <!-- Rechts: Info -->
                            <StackPanel Grid.Column="1" Spacing="16">
                                <!-- Preis -->
                                <TextBlock Text="{x:Bind ViewModel.FormattedPrice, Mode=OneWay}"
                                           FontSize="32"
                                           FontWeight="Bold"
                                           Foreground="{ThemeResource OnSurfaceBrush}" />

                                <!-- Titel -->
                                <TextBlock Text="{x:Bind ViewModel.Property.Titel, Mode=OneWay}"
                                           FontSize="24"
                                           FontWeight="SemiBold"
                                           Foreground="{ThemeResource OnSurfaceBrush}"
                                           TextWrapping="Wrap" />

                                <!-- Details -->
                                <TextBlock Text="{x:Bind ViewModel.DetailsText, Mode=OneWay}"
                                           FontSize="16"
                                           Foreground="{ThemeResource OnSurfaceVariantBrush}" />

                                <!-- Typ Badge -->
                                <Border Background="{ThemeResource AccentBrush}"
                                        CornerRadius="{StaticResource RadiusMd}"
                                        Padding="14,8"
                                        HorizontalAlignment="Left">
                                    <TextBlock Text="{x:Bind ViewModel.TypeText, Mode=OneWay}"
                                               FontSize="12"
                                               FontWeight="Bold"
                                               CharacterSpacing="60"
                                               Foreground="{ThemeResource ChipSelectedForegroundBrush}" />
                                </Border>

                                <!-- Beschreibung -->
                                <StackPanel Spacing="12" Margin="0,16,0,0">
                                    <TextBlock Text="Beschreibung"
                                               FontSize="18"
                                               FontWeight="SemiBold"
                                               Foreground="{ThemeResource OnSurfaceBrush}" />
                                    <TextBlock Text="{x:Bind ViewModel.Property.Beschreibung, Mode=OneWay}"
                                               FontSize="14"
                                               Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                               TextWrapping="Wrap"
                                               LineHeight="22" />
                                </StackPanel>

                                <!-- Ausstattung -->
                                <StackPanel Spacing="12" Margin="0,16,0,0">
                                    <TextBlock Text="Ausstattung"
                                               FontSize="18"
                                               FontWeight="SemiBold"
                                               Foreground="{ThemeResource OnSurfaceBrush}" />
                                    <TextBlock Text="{x:Bind ViewModel.AusstattungText, Mode=OneWay}"
                                               FontSize="14"
                                               Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                               TextWrapping="Wrap" />
                                </StackPanel>

                                <!-- Anbieter Info -->
                                <Border Background="{ThemeResource SolidBackgroundFillColorSecondary}"
                                        CornerRadius="{StaticResource RadiusMd}"
                                        Padding="16"
                                        Margin="0,16,0,0">
                                    <StackPanel Spacing="8">
                                        <TextBlock Text="Anbieter"
                                                   FontSize="14"
                                                   FontWeight="SemiBold"
                                                   Foreground="{ThemeResource OnSurfaceBrush}" />
                                        <TextBlock Text="{x:Bind ViewModel.Property.AnbieterName, Mode=OneWay}"
                                                   FontSize="14"
                                                   Foreground="{ThemeResource OnSurfaceVariantBrush}" />
                                    </StackPanel>
                                </Border>

                                <!-- CTA Button -->
                                <Button Content="Anbieter kontaktieren"
                                        Background="{ThemeResource AccentBrush}"
                                        Foreground="{ThemeResource ChipSelectedForegroundBrush}"
                                        FontWeight="SemiBold"
                                        FontSize="16"
                                        Height="56"
                                        Width="300"
                                        HorizontalAlignment="Left"
                                        HorizontalContentAlignment="Center"
                                        CornerRadius="{StaticResource RadiusMd}"
                                        Margin="0,24,0,0"
                                        Click="OnContactClick" />
                            </StackPanel>
                        </Grid>
                    </Grid>
                </ScrollViewer>
            </Grid>
        </uc:BusyOverlay>
    </Grid>
</Page>
