<Page x:Class="Heimatplatz.Features.Properties.Presentation.EditPropertyPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:Heimatplatz.Features.Properties.Presentation"
      xmlns:models="using:Heimatplatz.Features.Properties.Contracts.Models"
      Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Page.Resources>
        <!-- Consistent corner radius for all input controls -->
        <Style TargetType="TextBox" BasedOn="{StaticResource DefaultTextBoxStyle}">
            <Setter Property="CornerRadius" Value="{StaticResource RadiusSm}" />
        </Style>
        <Style TargetType="ComboBox" BasedOn="{StaticResource DefaultComboBoxStyle}">
            <Setter Property="CornerRadius" Value="{StaticResource RadiusSm}" />
        </Style>
    </Page.Resources>

    <!-- Visual States for Responsive Layout -->
    <VisualStateManager.VisualStateGroups>
        <VisualStateGroup x:Name="WindowSizeStates">
            <VisualState x:Name="WideState">
                <VisualState.StateTriggers>
                    <AdaptiveTrigger MinWindowWidth="600" />
                </VisualState.StateTriggers>
            </VisualState>

            <VisualState x:Name="NarrowState">
                <VisualState.StateTriggers>
                    <AdaptiveTrigger MinWindowWidth="0" />
                </VisualState.StateTriggers>
                <VisualState.Setters>
                    <!-- PropertyType Layout - Stack vertically -->
                    <Setter Target="PropertyTypeLayout.RowSpacing" Value="8" />
                    <Setter Target="PropertyTypeCombo.(Grid.Row)" Value="0" />
                    <Setter Target="PropertyTypeCombo.(Grid.Column)" Value="0" />
                    <Setter Target="PropertyTypeCombo.(Grid.ColumnSpan)" Value="2" />
                    <Setter Target="SellerTypeCombo.(Grid.Row)" Value="1" />
                    <Setter Target="SellerTypeCombo.(Grid.Column)" Value="0" />
                    <Setter Target="SellerTypeCombo.(Grid.ColumnSpan)" Value="2" />

                    <!-- Address Layout - Stack vertically -->
                    <Setter Target="AddressLayout.RowSpacing" Value="8" />
                    <Setter Target="AddressField.(Grid.Row)" Value="0" />
                    <Setter Target="AddressField.(Grid.Column)" Value="0" />
                    <Setter Target="AddressField.(Grid.ColumnSpan)" Value="3" />
                    <Setter Target="CityField.(Grid.Row)" Value="1" />
                    <Setter Target="CityField.(Grid.Column)" Value="0" />
                    <Setter Target="CityField.(Grid.ColumnSpan)" Value="3" />
                    <Setter Target="PostalCodeField.(Grid.Row)" Value="2" />
                    <Setter Target="PostalCodeField.(Grid.Column)" Value="0" />
                    <Setter Target="PostalCodeField.(Grid.ColumnSpan)" Value="3" />

                    <!-- Price Layout - Stack vertically -->
                    <Setter Target="PriceLayout.RowSpacing" Value="8" />
                    <Setter Target="PriceField.(Grid.Row)" Value="0" />
                    <Setter Target="PriceField.(Grid.Column)" Value="0" />
                    <Setter Target="PriceField.(Grid.ColumnSpan)" Value="2" />
                    <Setter Target="SellerNameField.(Grid.Row)" Value="1" />
                    <Setter Target="SellerNameField.(Grid.Column)" Value="0" />
                    <Setter Target="SellerNameField.(Grid.ColumnSpan)" Value="2" />

                    <!-- House Details Layout - Stack vertically -->
                    <Setter Target="HouseDetailsLayout.RowSpacing" Value="8" />
                    <Setter Target="WohnflaecheField.(Grid.Row)" Value="0" />
                    <Setter Target="WohnflaecheField.(Grid.Column)" Value="0" />
                    <Setter Target="WohnflaecheField.(Grid.ColumnSpan)" Value="2" />
                    <Setter Target="GrundstuecksflaecheField.(Grid.Row)" Value="1" />
                    <Setter Target="GrundstuecksflaecheField.(Grid.Column)" Value="0" />
                    <Setter Target="GrundstuecksflaecheField.(Grid.ColumnSpan)" Value="2" />
                    <Setter Target="ZimmerField.(Grid.Row)" Value="2" />
                    <Setter Target="ZimmerField.(Grid.Column)" Value="0" />
                    <Setter Target="ZimmerField.(Grid.ColumnSpan)" Value="2" />
                    <Setter Target="BaujahrField.(Grid.Row)" Value="3" />
                    <Setter Target="BaujahrField.(Grid.Column)" Value="0" />
                    <Setter Target="BaujahrField.(Grid.ColumnSpan)" Value="2" />
                </VisualState.Setters>
            </VisualState>
        </VisualStateGroup>
    </VisualStateManager.VisualStateGroups>

    <ScrollViewer>
        <StackPanel Padding="12" Spacing="8" MaxWidth="900">

            <!-- Header -->
            <TextBlock Text="Immobilie bearbeiten"
                       Style="{StaticResource TitleTextBlockStyle}"
                       Margin="0,0,0,8" />

            <!-- Loading Indicator -->
            <ProgressRing IsActive="{Binding IsLoading, Mode=OneWay}"
                          Width="40"
                          Height="40"
                          Margin="0,20,0,20"
                          Visibility="{Binding IsLoading, Mode=OneWay}" />

            <!-- Success/Error Messages -->
            <InfoBar Visibility="{Binding ShowSuccess, Mode=OneWay}"
                     Severity="Success"
                     Title="Erfolgreich"
                     Message="Immobilie wurde aktualisiert."
                     IsClosable="True"
                     IsOpen="True" />

            <InfoBar Visibility="{Binding HasError, Mode=OneWay}"
                     Severity="Error"
                     Title="Fehler"
                     Message="{Binding ErrorMessage, Mode=OneWay}"
                     IsClosable="True"
                     IsOpen="True" />

            <Grid x:Name="PropertyTypeLayout" ColumnSpacing="8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <ComboBox x:Name="PropertyTypeCombo"
                          Grid.Row="0"
                          Grid.Column="0"
                          Header="Immobilientyp *"
                          ItemsSource="{Binding PropertyTypes}"
                          SelectedItem="{Binding SelectedPropertyTypeItem, Mode=TwoWay}"
                          DisplayMemberPath="DisplayName"
                          HorizontalAlignment="Stretch" />

                <ComboBox x:Name="SellerTypeCombo"
                          Grid.Row="0"
                          Grid.Column="1"
                          Header="Anbietertyp *"
                          SelectedItem="{Binding SelectedAnbieterTyp, Mode=TwoWay}"
                          HorizontalAlignment="Stretch">
                    <x:String>Privat</x:String>
                    <x:String>Makler</x:String>
                </ComboBox>
            </Grid>

            <TextBox Header="Titel *"
                     Text="{Binding Titel, Mode=TwoWay}"
                     PlaceholderText="z.B. Schöne 3-Zimmer Wohnung" />

            <TextBox Header="Beschreibung *"
                     Text="{Binding Beschreibung, Mode=TwoWay}"
                     PlaceholderText="Detaillierte Beschreibung (mind. 50 Zeichen)"
                     TextWrapping="Wrap"
                     AcceptsReturn="True"
                     MinHeight="80"
                     MaxHeight="200" />

            <Grid x:Name="AddressLayout" ColumnSpacing="8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="100" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <TextBox x:Name="AddressField"
                         Grid.Row="0"
                         Grid.Column="0"
                         Header="Adresse *"
                         Text="{Binding Adresse, Mode=TwoWay}"
                         PlaceholderText="Straße und Hausnummer"
                         HorizontalAlignment="Stretch" />

                <TextBox x:Name="CityField"
                         Grid.Row="0"
                         Grid.Column="1"
                         Header="Ort *"
                         Text="{Binding Ort, Mode=TwoWay}"
                         PlaceholderText="z.B. Linz"
                         HorizontalAlignment="Stretch" />

                <TextBox x:Name="PostalCodeField"
                         Grid.Row="0"
                         Grid.Column="2"
                         Header="PLZ *"
                         Text="{Binding Plz, Mode=TwoWay}"
                         PlaceholderText="4020"
                         InputScope="Number"
                         HorizontalAlignment="Stretch" />
            </Grid>

            <!-- Preis & Anbieter -->
            <Grid x:Name="PriceLayout" ColumnSpacing="8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <TextBox x:Name="PriceField"
                         Grid.Row="0"
                         Grid.Column="0"
                         Header="Preis (€) *"
                         Text="{Binding Preis, Mode=TwoWay}"
                         PlaceholderText="z.B. 350000"
                         InputScope="Number"
                         HorizontalAlignment="Stretch" />

                <TextBox x:Name="SellerNameField"
                         Grid.Row="0"
                         Grid.Column="1"
                         Header="Anbieter-Name *"
                         Text="{Binding AnbieterName, Mode=TwoWay}"
                         PlaceholderText="Ihr Name"
                         HorizontalAlignment="Stretch" />
            </Grid>

            <!-- Immobilien-Details (Haus) -->
            <Grid x:Name="HouseDetailsLayout"
                  ColumnSpacing="8"
                  Visibility="{Binding IsHouseType, Mode=OneWay}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <TextBox x:Name="WohnflaecheField"
                         Grid.Row="0"
                         Grid.Column="0"
                         Header="Wohnfläche (m²)"
                         Text="{Binding WohnflaecheM2, Mode=TwoWay}"
                         PlaceholderText="90"
                         InputScope="Number"
                         HorizontalAlignment="Stretch" />

                <TextBox x:Name="GrundstuecksflaecheField"
                         Grid.Row="0"
                         Grid.Column="1"
                         Header="Grundstücksfläche (m²)"
                         Text="{Binding GrundstuecksflaecheM2, Mode=TwoWay}"
                         PlaceholderText="500"
                         InputScope="Number"
                         HorizontalAlignment="Stretch" />

                <TextBox x:Name="ZimmerField"
                         Grid.Row="1"
                         Grid.Column="0"
                         Header="Zimmer"
                         Text="{Binding Zimmer, Mode=TwoWay}"
                         PlaceholderText="3"
                         InputScope="Number"
                         HorizontalAlignment="Stretch" />

                <TextBox x:Name="BaujahrField"
                         Grid.Row="1"
                         Grid.Column="1"
                         Header="Baujahr"
                         Text="{Binding Baujahr, Mode=TwoWay}"
                         PlaceholderText="2005"
                         InputScope="Number"
                         HorizontalAlignment="Stretch" />
            </Grid>

            <!-- Grundstück (Land) -->
            <StackPanel Spacing="8"
                        Visibility="{Binding IsLandType, Mode=OneWay}">
                <TextBox Header="Grundstücksfläche (m²)"
                         Text="{Binding GrundstuecksflaecheM2, Mode=TwoWay}"
                         PlaceholderText="500"
                         InputScope="Number"
                         MinWidth="150" />
            </StackPanel>

            <!-- Primary Action -->
            <Button Content="Änderungen speichern"
                    Command="{Binding UpdatePropertyCommand}"
                    HorizontalAlignment="Stretch"
                    Height="48"
                    Margin="0,16,0,8"
                    Style="{StaticResource AccentButtonStyle}"
                    CornerRadius="{StaticResource RadiusSm}" />

            <TextBlock Text="* Pflichtfelder"
                       FontSize="11"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       Margin="0,4,0,0" />

        </StackPanel>
    </ScrollViewer>
</Page>
