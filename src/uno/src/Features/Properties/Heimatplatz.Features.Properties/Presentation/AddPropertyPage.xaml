<Page x:Class="Heimatplatz.Features.Properties.Presentation.AddPropertyPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:Heimatplatz.Features.Properties.Presentation"
      xmlns:models="using:Heimatplatz.Features.Properties.Contracts.Models"
      Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Page.Resources>
        <!-- Consistent corner radius for all input controls -->
        <Style TargetType="TextBox" BasedOn="{StaticResource DefaultTextBoxStyle}">
            <Setter Property="CornerRadius" Value="{StaticResource RadiusSm}" />
        </Style>
        <Style TargetType="ComboBox" BasedOn="{StaticResource DefaultComboBoxStyle}">
            <Setter Property="CornerRadius" Value="{StaticResource RadiusSm}" />
        </Style>
    </Page.Resources>

    <!-- Visual States for Responsive Layout -->
    <VisualStateManager.VisualStateGroups>
        <VisualStateGroup x:Name="WindowSizeStates">
            <VisualState x:Name="WideState">
                <VisualState.StateTriggers>
                    <AdaptiveTrigger MinWindowWidth="600" />
                </VisualState.StateTriggers>
            </VisualState>

            <VisualState x:Name="NarrowState">
                <VisualState.StateTriggers>
                    <AdaptiveTrigger MinWindowWidth="0" />
                </VisualState.StateTriggers>
                <VisualState.Setters>
                    <!-- Switch to vertical layouts -->
                    <Setter Target="PropertyTypeLayout.Orientation" Value="Vertical" />
                    <Setter Target="AddressLayout.Orientation" Value="Vertical" />
                    <Setter Target="PriceLayout.Orientation" Value="Vertical" />
                    <Setter Target="HouseDetailsLayout.Orientation" Value="Vertical" />

                    <!-- Remove width constraints for full-width fields -->
                    <Setter Target="CityField.Width" Value="NaN" />
                    <Setter Target="PostalCodeField.Width" Value="NaN" />
                    <Setter Target="WohnflaecheField.Width" Value="NaN" />
                    <Setter Target="ZimmerField.Width" Value="NaN" />
                    <Setter Target="BaujahrField.Width" Value="NaN" />
                </VisualState.Setters>
            </VisualState>
        </VisualStateGroup>
    </VisualStateManager.VisualStateGroups>

    <ScrollViewer>
        <StackPanel Padding="12" Spacing="8" MaxWidth="900">

            <!-- Header -->
            <TextBlock Text="Immobilie hinzufügen"
                       Style="{StaticResource TitleTextBlockStyle}"
                       Margin="0,0,0,8" />

            <!-- Success/Error Messages -->
            <InfoBar Visibility="{Binding ShowSuccess, Mode=OneWay}"
                     Severity="Success"
                     Title="Erfolgreich"
                     Message="Immobilie wurde erstellt."
                     IsClosable="True"
                     IsOpen="True" />

            <InfoBar Visibility="{Binding HasError, Mode=OneWay}"
                     Severity="Error"
                     Title="Fehler"
                     Message="{Binding ErrorMessage, Mode=OneWay}"
                     IsClosable="True"
                     IsOpen="True" />

            <StackPanel x:Name="PropertyTypeLayout" Spacing="8" Orientation="Horizontal">
                <ComboBox x:Name="PropertyTypeCombo"
                          Header="Immobilientyp *"
                          ItemsSource="{Binding PropertyTypes}"
                          SelectedItem="{Binding SelectedPropertyTypeItem, Mode=TwoWay}"
                          DisplayMemberPath="DisplayName"
                          HorizontalAlignment="Stretch" />

                <ComboBox x:Name="SellerTypeCombo"
                          Header="Anbietertyp *"
                          SelectedItem="{Binding SelectedAnbieterTyp, Mode=TwoWay}"
                          HorizontalAlignment="Stretch">
                    <x:String>Privat</x:String>
                    <x:String>Makler</x:String>
                </ComboBox>
            </StackPanel>

            <TextBox Header="Titel *"
                     Text="{Binding Titel, Mode=TwoWay}"
                     PlaceholderText="z.B. Schöne 3-Zimmer Wohnung" />

            <TextBox Header="Beschreibung *"
                     Text="{Binding Beschreibung, Mode=TwoWay}"
                     PlaceholderText="Detaillierte Beschreibung (mind. 50 Zeichen)"
                     TextWrapping="Wrap"
                     AcceptsReturn="True"
                     MinHeight="80"
                     MaxHeight="200" />

            <StackPanel x:Name="AddressLayout" Spacing="8" Orientation="Horizontal">
                <TextBox x:Name="AddressField"
                         Header="Adresse *"
                         Text="{Binding Adresse, Mode=TwoWay}"
                         PlaceholderText="Straße und Hausnummer"
                         HorizontalAlignment="Stretch" />

                <TextBox x:Name="CityField"
                         Header="Ort *"
                         Text="{Binding Ort, Mode=TwoWay}"
                         PlaceholderText="z.B. Linz"
                         HorizontalAlignment="Stretch"
                         Width="150" />

                <TextBox x:Name="PostalCodeField"
                         Header="PLZ *"
                         Text="{Binding Plz, Mode=TwoWay}"
                         PlaceholderText="4020"
                         InputScope="Number"
                         HorizontalAlignment="Stretch"
                         Width="100" />
            </StackPanel>

            <!-- Preis & Anbieter -->
            <StackPanel x:Name="PriceLayout" Spacing="8" Orientation="Horizontal">
                <TextBox x:Name="PriceField"
                         Header="Preis (€) *"
                         Text="{Binding Preis, Mode=TwoWay}"
                         PlaceholderText="z.B. 350000"
                         InputScope="Number"
                         HorizontalAlignment="Stretch" />

                <TextBox x:Name="SellerNameField"
                         Header="Anbieter-Name *"
                         Text="{Binding AnbieterName, Mode=TwoWay}"
                         PlaceholderText="Ihr Name"
                         HorizontalAlignment="Stretch" />
            </StackPanel>

            <!-- Immobilien-Details (Haus) -->
            <StackPanel x:Name="HouseDetailsLayout"
                        Spacing="8"
                        Orientation="Horizontal"
                        Visibility="{Binding IsHouseType, Mode=OneWay}">
                <TextBox x:Name="WohnflaecheField"
                         Header="Wohnfläche (m²)"
                         Text="{Binding WohnflaecheM2, Mode=TwoWay}"
                         PlaceholderText="90"
                         InputScope="Number"
                         HorizontalAlignment="Stretch"
                         Width="180" />

                <TextBox x:Name="ZimmerField"
                         Header="Zimmer"
                         Text="{Binding Zimmer, Mode=TwoWay}"
                         PlaceholderText="3"
                         InputScope="Number"
                         HorizontalAlignment="Stretch"
                         Width="120" />

                <TextBox x:Name="BaujahrField"
                         Header="Baujahr"
                         Text="{Binding Baujahr, Mode=TwoWay}"
                         PlaceholderText="2005"
                         InputScope="Number"
                         HorizontalAlignment="Stretch"
                         Width="120" />
            </StackPanel>

            <!-- Grundstück (Land) -->
            <StackPanel Spacing="8"
                        Visibility="{Binding IsLandType, Mode=OneWay}">
                <TextBox Header="Grundstücksfläche (m²)"
                         Text="{Binding GrundstuecksflaecheM2, Mode=TwoWay}"
                         PlaceholderText="500"
                         InputScope="Number"
                         MinWidth="150" />
            </StackPanel>

            <!-- Primary Action -->
            <Button Content="Speichern"
                    Command="{Binding SavePropertyCommand}"
                    HorizontalAlignment="Stretch"
                    Height="48"
                    Margin="0,16,0,8"
                    Style="{StaticResource AccentButtonStyle}"
                    CornerRadius="{StaticResource RadiusSm}" />

            <TextBlock Text="* Pflichtfelder"
                       FontSize="11"
                       Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                       Margin="0,4,0,0" />

        </StackPanel>
    </ScrollViewer>
</Page>
