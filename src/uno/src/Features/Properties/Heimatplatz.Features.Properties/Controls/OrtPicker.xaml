<UserControl x:Class="Heimatplatz.Features.Properties.Controls.OrtPicker"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="using:Heimatplatz.Features.Properties.Controls"
             xmlns:models="using:Heimatplatz.Features.Properties.Models"
             xmlns:converters="using:Heimatplatz.Features.Properties.Converters">

    <UserControl.Resources>
        <converters:ExpanderGlyphConverter x:Key="ExpanderGlyphConverter" />
    </UserControl.Resources>

    <!--
    OrtPicker - Bezirk/Gemeinde Picker mit Checkboxen (ohne Bundesland-Ebene)
    -->

    <Grid>
        <Button x:Name="PickerButton"
                HorizontalAlignment="Stretch"
                HorizontalContentAlignment="Stretch"
                Background="{ThemeResource SurfaceBrush}"
                BorderBrush="{ThemeResource BorderBrush}"
                BorderThickness="1"
                CornerRadius="{StaticResource RadiusSm}"
                Padding="12,8"
                AutomationProperties.AutomationId="OrtPicker_Button">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <TextBlock x:Name="SelectionText"
                           Grid.Column="0"
                           Text="Ort ausw채hlen"
                           FontSize="14"
                           Foreground="{ThemeResource OnSurfaceVariantBrush}"
                           VerticalAlignment="Center"
                           TextTrimming="CharacterEllipsis" />

                <FontIcon Grid.Column="1"
                          Glyph="&#xE70D;"
                          FontSize="12"
                          Foreground="{ThemeResource OnSurfaceVariantBrush}"
                          VerticalAlignment="Center" />
            </Grid>

            <Button.Flyout>
                <Flyout x:Name="PickerFlyout"
                        Placement="Bottom">
                    <Border Background="{ThemeResource SurfaceBrush}"
                            CornerRadius="{StaticResource RadiusSm}"
                            Padding="12"
                            Margin="-12">
                        <StackPanel MinWidth="280"
                                    MaxHeight="400"
                                    Spacing="4">

                            <!-- Header mit "Alle abw채hlen" -->
                            <Grid Margin="0,0,0,8">
                                <TextBlock Text="Orte ausw채hlen"
                                           FontSize="14"
                                           FontWeight="SemiBold"
                                           Foreground="{ThemeResource OnSurfaceBrush}" />
                                <Button x:Name="ClearAllButton"
                                        Content="Zur체cksetzen"
                                        HorizontalAlignment="Right"
                                        FontSize="12"
                                        Padding="8,4"
                                        Background="Transparent"
                                        Foreground="{ThemeResource OnSurfaceVariantBrush}"
                                        Click="ClearAllButton_Click" />
                            </Grid>

                            <!-- Loading -->
                            <ProgressRing x:Name="LoadingRing"
                                          IsActive="False"
                                          Width="24"
                                          Height="24"
                                          HorizontalAlignment="Center"
                                          Visibility="Collapsed" />

                            <!-- Bezirke Liste (aufklappbar mit Gemeinden) -->
                            <ScrollViewer MaxHeight="340"
                                          VerticalScrollBarVisibility="Auto">
                                <ItemsRepeater x:Name="BezirkeRepeater"
                                               ItemsSource="{x:Bind Bezirke, Mode=OneWay}">
                                    <ItemsRepeater.ItemTemplate>
                                        <DataTemplate x:DataType="models:BezirkModel">
                                            <StackPanel Margin="0,2">
                                                <!-- Bezirk Header (aufklappbar) -->
                                                <Button HorizontalAlignment="Stretch"
                                                        HorizontalContentAlignment="Left"
                                                        Background="Transparent"
                                                        Padding="4"
                                                        Click="BezirkHeader_Click"
                                                        Tag="{x:Bind}">
                                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                                        <FontIcon Glyph="{x:Bind IsExpanded, Mode=OneWay, Converter={StaticResource ExpanderGlyphConverter}}"
                                                                  FontSize="10"
                                                                  Foreground="{ThemeResource PrimaryBrush}" />
                                                        <TextBlock Text="{x:Bind Name}"
                                                                   FontSize="14"
                                                                   FontWeight="SemiBold"
                                                                   Foreground="{ThemeResource OnSurfaceBrush}" />
                                                    </StackPanel>
                                                </Button>

                                                <!-- Gemeinden (wenn Bezirk expanded) -->
                                                <ItemsRepeater ItemsSource="{x:Bind Gemeinden}"
                                                               Visibility="{x:Bind IsExpanded, Mode=OneWay}"
                                                               Margin="20,0,0,0">
                                                    <ItemsRepeater.ItemTemplate>
                                                        <DataTemplate x:DataType="models:GemeindeModel">
                                                            <CheckBox Content="{x:Bind Name}"
                                                                      IsChecked="{x:Bind IsSelected, Mode=TwoWay}"
                                                                      Margin="0,2"
                                                                      FontSize="13" />
                                                        </DataTemplate>
                                                    </ItemsRepeater.ItemTemplate>
                                                </ItemsRepeater>
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsRepeater.ItemTemplate>
                                </ItemsRepeater>
                            </ScrollViewer>
                        </StackPanel>
                    </Border>
                </Flyout>
            </Button.Flyout>
        </Button>
    </Grid>
</UserControl>
